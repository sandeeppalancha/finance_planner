<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Finance Tracker">
  <meta name="description" content="Personal finance tracking and planning app">
  <meta name="theme-color" content="#6d28d9">
  <meta name="application-name" content="Finance Tracker">
  
  <title>Finance Tracker</title>
  
  <!-- iOS icons -->
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon-180x180.png">
  <link rel="apple-touch-icon" sizes="167x167" href="apple-touch-icon-167x167.png">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="manifest.json">
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
    }
    
    body {
      background-color: #f5f5f5;
      color: #333;
      padding-bottom: 70px;
      -webkit-user-select: none;
      user-select: none;
    }
    
    .header {
      background-color: #6d28d9;
      color: white;
      padding: 16px;
      text-align: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    
    .app-container {
      max-width: 800px;
      margin: 0 auto;
      padding: 12px;
    }
    
    .tab-bar {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      background-color: white;
      display: flex;
      justify-content: space-around;
      padding: 10px 0;
      box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
    }
    
    .tab {
      color: #6d28d9;
      text-decoration: none;
      text-align: center;
      font-size: 12px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .tab-icon {
      font-size: 20px;
      margin-bottom: 4px;
    }
    
    .page {
      display: none;
    }
    
    .page.active {
      display: block;
    }
    
    .card {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 16px;
      overflow: hidden;
    }
    
    .card-header {
      background-color: #6d28d9;
      color: white;
      padding: 10px 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .card-body {
      padding: 16px;
    }
    
    .table {
      width: 100%;
      border-collapse: collapse;
    }
    
    .table th,
    .table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #eee;
    }
    
    .table th {
      font-weight: 600;
      color: #555;
    }
    
    .summary-item {
      padding: 12px 16px;
      border-bottom: 1px solid #eee;
      display: flex;
      justify-content: space-between;
    }
    
    .summary-item:last-child {
      border-bottom: none;
    }
    
    .add-button {
      position: fixed;
      bottom: 80px;
      right: 20px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background-color: #6d28d9;
      color: white;
      display: flex;
      justify-content: center;
      align-items: center;
      font-size: 24px;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
      cursor: pointer;
      z-index: 5;
    }
    
    .form-group {
      margin-bottom: 16px;
    }
    
    .form-label {
      display: block;
      margin-bottom: 6px;
      font-weight: 500;
      color: #555;
    }
    
    .form-input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 16px;
    }
    
    .button {
      background-color: #6d28d9;
      color: white;
      border: none;
      border-radius: 4px;
      padding: 12px 16px;
      font-size: 16px;
      cursor: pointer;
      width: 100%;
    }
    
    .modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 20;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0s linear 0.25s, opacity 0.25s;
    }
    
    .modal.active {
      visibility: visible;
      opacity: 1;
      transition-delay: 0s;
    }
    
    .modal-content {
      background-color: white;
      border-radius: 8px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      background-color: #6d28d9;
      color: white;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .modal-body {
      padding: 16px;
    }
    
    .close-modal {
      background: none;
      border: none;
      color: white;
      font-size: 20px;
      cursor: pointer;
    }
    
    .offline-banner {
      position: fixed;
      bottom: 70px;
      left: 10px;
      right: 10px;
      background-color: #fef3c7;
      color: #92400e;
      padding: 12px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      display: none;
      align-items: center;
      z-index: 15;
    }
    
    .offline-banner.visible {
      display: flex;
    }
    
    .startup-screen {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #6d28d9;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
      color: white;
      transition: opacity 0.5s ease-in-out;
      opacity: 1;
    }
    
    .startup-screen.hide {
      opacity: 0;
      pointer-events: none;
    }
    
    .startup-icon {
      font-size: 60px;
      margin-bottom: 20px;
    }
    
    .startup-title {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 10px;
    }
    
    .startup-subtitle {
      font-size: 16px;
      opacity: 0.8;
    }
    
    /* Chits page specific styles */
    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 16px;
    }
    
    .section-title {
      padding: 10px 16px;
      border-bottom: 1px solid #e0e0e0;
      background-color: #f9f9f9;
    }
    
    .item-list {
      padding: 8px 0;
    }
    
    .list-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px 16px;
      border-bottom: 1px solid #eaeaea;
    }
    
    .item-main {
      flex: 1;
    }
    
    .item-name {
      font-weight: bold;
      font-size: 1rem;
      margin-bottom: 4px;
    }
    
    .item-details {
      font-size: 0.85rem;
      color: #666;
    }
    
    .item-amount {
      font-weight: bold;
      font-size: 1.1rem;
      margin: 0 16px;
      color: #6d28d9;
    }
    
    .item-actions {
      display: flex;
      gap: 8px;
    }
    
    .maturity-list {
      padding: 8px 16px;
    }
    
    .maturity-item {
      margin-bottom: 16px;
    }
    
    .maturity-info {
      display: flex;
      justify-content: space-between;
      margin-bottom: 8px;
    }
    
    .maturity-name {
      font-weight: bold;
    }
    
    .maturity-date {
      color: #666;
    }
    
    .progress-bar {
      height: 8px;
      background-color: #eaeaea;
      border-radius: 4px;
      overflow: hidden;
      margin-bottom: 4px;
    }
    
    .progress-fill {
      height: 100%;
      background-color: #6d28d9;
      border-radius: 4px;
    }
    
    .maturity-details {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #666;
    }
  </style>
</head>
<body>
  <!-- Startup Screen -->
  <div class="startup-screen" id="startupScreen">
    <div class="startup-icon">💰</div>
    <div class="startup-title">Finance Tracker</div>
    <div class="startup-subtitle">Your personal finance companion</div>
  </div>

  <div class="offline-banner" id="offlineBanner">
    <span>📶 You're offline. Changes will be saved locally.</span>
  </div>

  <header class="header">
    <h1>Finance Tracker</h1>
  </header>
  
  <main class="app-container">
    <!-- Dashboard Page -->
    <div class="page active" id="dashboardPage">
      <h2>Dashboard</h2>
      
      <div class="card">
        <div class="card-header">
          <h3>Financial Overview</h3>
        </div>
        <div class="card-body">
          <div class="summary-item">
            <span>Net Worth</span>
            <span id="netWorth">₹0</span>
          </div>
          <div class="summary-item">
            <span>Total Receivables</span>
            <span id="totalReceivables">₹0</span>
          </div>
          <div class="summary-item">
            <span>Money Lent</span>
            <span id="totalMoneyLent">₹0</span>
          </div>
          <div class="summary-item">
            <span>Total Payables</span>
            <span id="totalPayables">₹0</span>
          </div>
          <div class="summary-item">
            <span>Total Investments</span>
            <span id="totalInvestments">₹0</span>
          </div>
          <div class="summary-item">
            <span>Total Chits</span>
            <span id="totalChits">₹0</span>
          </div>
          <div class="summary-item">
            <span>Bank Balance</span>
            <span id="totalBankBalance">₹0</span>
          </div>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3>Receivables</h3>
          <a href="#" onclick="switchPage('receivablesPage')">View All</a>
        </div>
        <div class="card-body">
          <table class="table" id="dashboardReceivablesTable">
            <thead>
              <tr>
                <th>From</th>
                <th>Amount</th>
                <th>Due Date</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3>Money Lent</h3>
          <a href="#" onclick="switchPage('moneyLentPage')">View All</a>
        </div>
        <div class="card-body">
          <table class="table" id="dashboardMoneyLentTable">
            <thead>
              <tr>
                <th>To</th>
                <th>Amount</th>
                <th>Date</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="card">
        <div class="card-header">
          <h3>Payables</h3>
          <a href="#" onclick="switchPage('payablesPage')">View All</a>
        </div>
        <div class="card-body">
          <table class="table" id="dashboardPayablesTable">
            <thead>
              <tr>
                <th>To</th>
                <th>Amount</th>
                <th>Due Date</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be loaded dynamically -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
    
    <!-- Receivables Page -->
    <div class="page" id="receivablesPage">
      <h2>Receivables</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Receivables</h3>
        </div>
        <div class="card-body">
          <table class="table" id="receivablesTable">
            <thead>
              <tr>
                <th>From</th>
                <th>Amount</th>
                <th>Due Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Data will be loaded dynamically -->
              <tr>
                <td>Rahul</td>
                <td>₹5,000</td>
                <td>May 15</td>
                <td>
                  <button onclick="editReceivable(1)">Edit</button>
                  <button onclick="deleteReceivable(1)">Delete</button>
                </td>
              </tr>
              <tr>
                <td>Priya</td>
                <td>₹7,500</td>
                <td>Jun 5</td>
                <td>
                  <button onclick="editReceivable(2)">Edit</button>
                  <button onclick="deleteReceivable(2)">Delete</button>
                </td>
              </tr>
              <tr>
                <td>Ankit</td>
                <td>₹10,000</td>
                <td>Jun 12</td>
                <td>
                  <button onclick="editReceivable(3)">Edit</button>
                  <button onclick="deleteReceivable(3)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="add-button" onclick="showModal('receivableModal')">+</div>
    </div>
    
    <!-- Payables Page -->
    <div class="page" id="payablesPage">
      <h2>Payables</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Payables</h3>
        </div>
        <div class="card-body">
          <table class="table" id="payablesTable">
            <thead>
              <tr>
                <th>To</th>
                <th>Amount</th>
                <th>Due Date</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Electricity Bill</td>
                <td>₹1,850</td>
                <td>Apr 20</td>
                <td>
                  <button onclick="editPayable(1)">Edit</button>
                  <button onclick="deletePayable(1)">Delete</button>
                </td>
              </tr>
              <tr>
                <td>Internet</td>
                <td>₹1,200</td>
                <td>Apr 25</td>
                <td>
                  <button onclick="editPayable(2)">Edit</button>
                  <button onclick="deletePayable(2)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="add-button" onclick="showModal('payableModal')">+</div>
    </div>
    
    <!-- Investments Page -->
    <div class="page" id="investmentsPage">
      <h2>Investments</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Investments</h3>
        </div>
        <div class="card-body">
          <table class="table" id="investmentsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Amount</th>
                <th>Frequency</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Equity SIP</td>
                <td>₹7,500</td>
                <td>Monthly</td>
                <td>
                  <button onclick="editInvestment(1)">Edit</button>
                  <button onclick="deleteInvestment(1)">Delete</button>
                </td>
              </tr>
              <tr>
                <td>Fixed Deposit</td>
                <td>₹100,000</td>
                <td>One-time</td>
                <td>
                  <button onclick="editInvestment(2)">Edit</button>
                  <button onclick="deleteInvestment(2)">Delete</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="add-button" onclick="showModal('investmentModal')">+</div>
    </div>
    
    <!-- Budgets Page -->
    <div class="page" id="budgetsPage">
      <h2>Budget Plans</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Budget Plans</h3>
        </div>
        <div class="card-body">
          <table class="table" id="budgetsTable">
            <thead>
              <tr>
                <th>Name</th>
                <th>Target</th>
                <th>Current</th>
                <th>Target Date</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>New Car</td>
                <td>₹1,200,000</td>
                <td>₹250,000 (21%)</td>
                <td>Dec 2025</td>
              </tr>
              <tr>
                <td>Land Purchase</td>
                <td>₹5,000,000</td>
                <td>₹850,000 (17%)</td>
                <td>Mar 2027</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
      <div class="add-button" onclick="showModal('budgetModal')">+</div>
    </div>
    
    <!-- Accounts Page -->
    <div class="page" id="accountsPage">
      <h2>Bank Accounts</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Accounts</h3>
        </div>
        <div class="card-body">
          <table class="table" id="accountsTable">
            <thead>
              <tr>
                <th>Bank</th>
                <th>Account Number</th>
                <th>Balance</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Will be populated from localStorage -->
            </tbody>
          </table>
          
          <div class="add-button-container">
            <div class="add-button" onclick="showModal('accountModal')">+</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Money Lent Page -->
    <div class="page" id="moneyLentPage">
      <h2>Money Lent</h2>
      <div class="card">
        <div class="card-header">
          <h3>All Money Lent</h3>
        </div>
        <div class="card-body">
          <table class="table" id="moneyLentTable">
            <thead>
              <tr>
                <th>To</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Notes</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <!-- Will be populated from localStorage -->
            </tbody>
          </table>
          
          <div class="add-button-container">
            <div class="add-button" onclick="showModal('moneyLentModal')">+</div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Chits Page -->
    <div class="page" id="chitsPage">
      <div class="page-header">
        <h2>Chits</h2>
        <div class="add-button" onclick="showModal('chitModal')">+</div>
      </div>
      
      <div class="card">
        <div class="section-title">
          <h3>Active Chits</h3>
        </div>
        <div class="item-list" id="chitsList">
          <!-- Sample chit items - will be dynamically generated from localStorage -->
          <div class="list-item" id="chit-1">
            <div class="item-main">
              <div class="item-name">Family Chit</div>
              <div class="item-details">₹5,000 monthly • Started: Jun 2024</div>
            </div>
            <div class="item-amount">₹60,000</div>
            <div class="item-actions">
              <button class="edit-button" onclick="editChit(1)">Edit</button>
              <button class="delete-button" onclick="deleteChit(1)">Delete</button>
            </div>
          </div>
          <div class="list-item" id="chit-2">
            <div class="item-main">
              <div class="item-name">Office Group</div>
              <div class="item-details">₹2,500 monthly • Started: Jan 2025</div>
            </div>
            <div class="item-amount">₹7,500</div>
            <div class="item-actions">
              <button class="edit-button" onclick="editChit(2)">Edit</button>
              <button class="delete-button" onclick="deleteChit(2)">Delete</button>
            </div>
          </div>
        </div>
        
        <div class="section-title">
          <h3>Upcoming Maturities</h3>
        </div>
        <div class="maturity-list">
          <div class="maturity-item">
            <div class="maturity-info">
              <span class="maturity-name">Family Chit</span>
              <span class="maturity-date">Jun 2026</span>
            </div>
            <div class="maturity-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: 25%"></div>
              </div>
              <div class="maturity-details">
                <span class="months-remaining">18 months remaining</span>
                <span class="final-amount">Final: ₹120,000</span>
              </div>
            </div>
          </div>
          <div class="maturity-item">
            <div class="maturity-info">
              <span class="maturity-name">Office Group</span>
              <span class="maturity-date">Jan 2027</span>
            </div>
            <div class="maturity-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: 10%"></div>
              </div>
              <div class="maturity-details">
                <span class="months-remaining">21 months remaining</span>
                <span class="final-amount">Final: ₹60,000</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Past Expenses Page -->
    <div class="page" id="pastExpensesPage">
      <div class="page-header">
        <h2>Past Expenses</h2>
        <div class="add-button" onclick="showModal('pastExpenseModal')">+</div>
      </div>
      
      <div class="card">
        <div class="section-title">
          <h3>Recent Major Expenses</h3>
        </div>
        <div class="item-list" id="pastExpensesList">
          <!-- Sample past expense items - will be dynamically generated from localStorage -->
          <div class="list-item" id="pastExpense-1">
            <div class="item-main">
              <div class="item-name">New Laptop Purchase</div>
              <div class="item-details">Apr 2025 • Electronics</div>
            </div>
            <div class="item-amount">₹85,000</div>
            <div class="item-actions">
              <button class="action-button edit-button" onclick="editPastExpense(1)"><i class="fa fa-edit"></i></button>
              <button class="action-button delete-button" onclick="deleteItem('pastExpense', 1)"><i class="fa fa-trash"></i></button>
            </div>
          </div>
        </div>
        <div class="table-footer" id="pastExpensesTotalRow">
          <span class="total-label">Total</span>
          <span class="total-amount">₹85,000</span>
        </div>
      </div>
    </div>
    
    <!-- Upcoming Expenses Page -->
    <div class="page" id="upcomingExpensesPage">
      <div class="page-header">
        <h2>Upcoming Expenses</h2>
        <div class="add-button" onclick="showModal('upcomingExpenseModal')">+</div>
      </div>
      
      <div class="card">
        <div class="section-title">
          <h3>Planned Major Expenses</h3>
        </div>
        <div class="item-list" id="upcomingExpensesList">
          <!-- Sample upcoming expense items - will be dynamically generated from localStorage -->
          <div class="list-item" id="upcomingExpense-1">
            <div class="item-main">
              <div class="item-name">Family Vacation</div>
              <div class="item-details">May 2025 • Travel</div>
            </div>
            <div class="item-amount">₹150,000</div>
            <div class="item-actions">
              <button class="action-button edit-button" onclick="editUpcomingExpense(1)"><i class="fa fa-edit"></i></button>
              <button class="action-button delete-button" onclick="deleteItem('upcomingExpense', 1)"><i class="fa fa-trash"></i></button>
            </div>
          </div>
        </div>
        <div class="table-footer" id="upcomingExpensesTotalRow">
          <span class="total-label">Total</span>
          <span class="total-amount">₹150,000</span>
        </div>
      </div>
    </div>
  </main>
  
  <!-- Tab Navigation -->
  <nav class="tab-bar">
    <a href="#" class="tab active" onclick="switchPage('dashboardPage')">
      <span class="tab-icon">📊</span>
      <span>Dashboard</span>
    </a>
    <a href="#" class="tab" onclick="switchPage('moneyPage')">
      <span class="tab-icon">💸</span>
      <span>Money</span>
    </a>
    <a href="#" class="tab" onclick="switchPage('investmentsPage')">
      <span class="tab-icon">📈</span>
      <span>Invest</span>
    </a>
    <a href="#" class="tab" onclick="switchPage('planningPage')">
      <span class="tab-icon">📝</span>
      <span>Planning</span>
    </a>
  </nav>
  
  <!-- Modals -->
  <!-- Receivable Modal -->
  <div class="modal" id="receivableModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="receivableModalTitle">Add Receivable</h3>
        <button class="close-modal" onclick="hideModal('receivableModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="receivableForm">
          <input type="hidden" id="receivableId">
          <div class="form-group">
            <label class="form-label" for="receivableFrom">From</label>
            <input type="text" id="receivableFrom" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="receivableAmount">Amount (₹)</label>
            <input type="number" id="receivableAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="receivableDueDate">Due Date</label>
            <input type="date" id="receivableDueDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="receivableDescription">Description (Optional)</label>
            <input type="text" id="receivableDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Receivable</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Payable Modal -->
  <div class="modal" id="payableModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="payableModalTitle">Add Payable</h3>
        <button class="close-modal" onclick="hideModal('payableModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="payableForm">
          <input type="hidden" id="payableId">
          <div class="form-group">
            <label class="form-label" for="payableTo">To</label>
            <input type="text" id="payableTo" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="payableAmount">Amount (₹)</label>
            <input type="number" id="payableAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="payableDueDate">Due Date</label>
            <input type="date" id="payableDueDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="payableDescription">Description (Optional)</label>
            <input type="text" id="payableDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Payable</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Investment Modal -->
  <div class="modal" id="investmentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="investmentModalTitle">Add Investment</h3>
        <button class="close-modal" onclick="hideModal('investmentModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="investmentForm">
          <input type="hidden" id="investmentId">
          <div class="form-group">
            <label class="form-label" for="investmentName">Investment Name</label>
            <input type="text" id="investmentName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="investmentAmount">Amount (₹)</label>
            <input type="number" id="investmentAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="investmentType">Type</label>
            <select id="investmentType" class="form-input">
              <option value="">Select Type</option>
              <option value="Equity">Equity</option>
              <option value="MutualFund">Mutual Fund</option>
              <option value="FixedDeposit">Fixed Deposit</option>
              <option value="Gold">Gold</option>
              <option value="RealEstate">Real Estate</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="investmentDescription">Description (Optional)</label>
            <input type="text" id="investmentDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Investment</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Budget Modal -->
  <div class="modal" id="budgetModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="budgetModalTitle">Add Budget</h3>
        <button class="close-modal" onclick="hideModal('budgetModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="budgetForm">
          <input type="hidden" id="budgetId">
          <div class="form-group">
            <label class="form-label" for="budgetName">Budget Name</label>
            <input type="text" id="budgetName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="budgetTargetAmount">Target Amount (₹)</label>
            <input type="number" id="budgetTargetAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="budgetCategory">Category</label>
            <select id="budgetCategory" class="form-input">
              <option value="">Select Category</option>
              <option value="Car">Car</option>
              <option value="House">House</option>
              <option value="Education">Education</option>
              <option value="Travel">Travel</option>
              <option value="Emergency">Emergency</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="budgetDeadline">Target Date</label>
            <input type="date" id="budgetDeadline" class="form-input" required>
          </div>
          <button type="submit" class="button">Save Budget</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Account Modal -->
  <div class="modal" id="accountModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="accountModalTitle">Add Bank Account</h3>
        <button class="close-modal" onclick="hideModal('accountModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="accountForm">
          <input type="hidden" id="accountId">
          <div class="form-group">
            <label class="form-label" for="accountName">Bank Name</label>
            <input type="text" id="accountName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="accountNumber">Account Number</label>
            <input type="text" id="accountNumber" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="accountBalance">Current Balance (₹)</label>
            <input type="number" id="accountBalance" class="form-input" required>
          </div>
          <button type="submit" class="button">Save Account</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Chit Modal -->
  <div class="modal" id="chitModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="chitModalTitle">Add Chit</h3>
        <button class="close-modal" onclick="hideModal('chitModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="chitForm">
          <input type="hidden" id="chitId">
          <div class="form-group">
            <label class="form-label" for="chitName">Chit Name</label>
            <input type="text" id="chitName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="chitAmount">Monthly Amount (₹)</label>
            <input type="number" id="chitAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="chitStartMonth">Start Month</label>
            <select id="chitStartMonth" class="form-input" required>
              <option value="">Select Month</option>
              <option value="0">January</option>
              <option value="1">February</option>
              <option value="2">March</option>
              <option value="3">April</option>
              <option value="4">May</option>
              <option value="5">June</option>
              <option value="6">July</option>
              <option value="7">August</option>
              <option value="8">September</option>
              <option value="9">October</option>
              <option value="10">November</option>
              <option value="11">December</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="chitStartYear">Start Year</label>
            <input type="number" id="chitStartYear" class="form-input" required min="2020" max="2050" value="2025">
          </div>
          <div class="form-group">
            <label class="form-label" for="chitDuration">Duration (Months)</label>
            <input type="number" id="chitDuration" class="form-input" required min="1" max="120">
          </div>
          <div class="form-group">
            <label class="form-label" for="chitDescription">Description (Optional)</label>
            <input type="text" id="chitDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Chit</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Money Lent Modal -->
  <div class="modal" id="moneyLentModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="moneyLentModalTitle">Add Money Lent</h3>
        <button class="close-modal" onclick="hideModal('moneyLentModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="moneyLentForm">
          <input type="hidden" id="moneyLentId">
          <div class="form-group">
            <label class="form-label" for="moneyLentTo">Lent To</label>
            <input type="text" id="moneyLentTo" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="moneyLentAmount">Amount (₹)</label>
            <input type="number" id="moneyLentAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="moneyLentDate">Date</label>
            <input type="date" id="moneyLentDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="moneyLentDescription">Description (Optional)</label>
            <input type="text" id="moneyLentDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Money Lent</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Past Expense Modal -->
  <div class="modal" id="pastExpenseModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="pastExpenseModalTitle">Add Past Expense</h3>
        <button class="close-modal" onclick="hideModal('pastExpenseModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="pastExpenseForm">
          <input type="hidden" id="pastExpenseId">
          <div class="form-group">
            <label class="form-label" for="pastExpenseName">Expense Name</label>
            <input type="text" id="pastExpenseName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="pastExpenseAmount">Amount (₹)</label>
            <input type="number" id="pastExpenseAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="pastExpenseDate">Date</label>
            <input type="date" id="pastExpenseDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="pastExpenseCategory">Category</label>
            <select id="pastExpenseCategory" class="form-input">
              <option value="">Select Category</option>
              <option value="Car">Car</option>
              <option value="House">House</option>
              <option value="Electronics">Electronics</option>
              <option value="Education">Education</option>
              <option value="Travel">Travel</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Home Appliances">Home Appliances</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="pastExpenseDescription">Description (Optional)</label>
            <input type="text" id="pastExpenseDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Past Expense</button>
        </form>
      </div>
    </div>
  </div>
  
  <!-- Upcoming Expense Modal -->
  <div class="modal" id="upcomingExpenseModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 id="upcomingExpenseModalTitle">Add Upcoming Expense</h3>
        <button class="close-modal" onclick="hideModal('upcomingExpenseModal')">&times;</button>
      </div>
      <div class="modal-body">
        <form id="upcomingExpenseForm">
          <input type="hidden" id="upcomingExpenseId">
          <div class="form-group">
            <label class="form-label" for="upcomingExpenseName">Expense Name</label>
            <input type="text" id="upcomingExpenseName" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="upcomingExpenseAmount">Amount (₹)</label>
            <input type="number" id="upcomingExpenseAmount" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="upcomingExpenseDate">Expected Date</label>
            <input type="date" id="upcomingExpenseDate" class="form-input" required>
          </div>
          <div class="form-group">
            <label class="form-label" for="upcomingExpenseCategory">Category</label>
            <select id="upcomingExpenseCategory" class="form-input">
              <option value="">Select Category</option>
              <option value="Car">Car</option>
              <option value="House">House</option>
              <option value="Electronics">Electronics</option>
              <option value="Education">Education</option>
              <option value="Travel">Travel</option>
              <option value="Healthcare">Healthcare</option>
              <option value="Home Appliances">Home Appliances</option>
              <option value="Other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label" for="upcomingExpenseDescription">Description (Optional)</label>
            <input type="text" id="upcomingExpenseDescription" class="form-input">
          </div>
          <button type="submit" class="button">Save Upcoming Expense</button>
        </form>
      </div>
    </div>
  </div>
  
  <script>
    // Register service worker
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/finance_planner/sw.js')
          .then(registration => {
            console.log('ServiceWorker registration successful with scope: ', registration.scope);
          })
          .catch(err => {
            console.log('ServiceWorker registration failed: ', err);
          });
      });
    }
    
    // Global constants
    const STORAGE_KEYS = {
      RECEIVABLES: 'finance_receivables',
      PAYABLES: 'finance_payables',
      INVESTMENTS: 'finance_investments',
      BUDGETS: 'finance_budgets',
      ACCOUNTS: 'finance_accounts',
      CHITS: 'finance_chits',
      MONEY_LENT: 'finance_money_lent',
      PAST_EXPENSES: 'finance_past_expenses',
      UPCOMING_EXPENSES: 'finance_upcoming_expenses',
      LAST_SYNC: 'finance_last_sync'
    };
    
    // DOM Elements
    const pages = document.querySelectorAll('.page');
    const tabs = document.querySelectorAll('.tab');
    const offlineBanner = document.getElementById('offlineBanner');
    const startupScreen = document.getElementById('startupScreen');
    
    // Initialize app
    document.addEventListener('DOMContentLoaded', () => {
      // Hide startup screen after a delay
      setTimeout(() => {
        startupScreen.classList.add('hide');
      }, 2000);
      
      // Show offline banner if needed
      checkConnectivity();
      
      // Add event listeners
      window.addEventListener('online', checkConnectivity);
      window.addEventListener('offline', checkConnectivity);
      
      // Load initial data from localStorage
      updateFinancialSummary();
      
      // Setup forms
      document.getElementById('receivableForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('receivableId').value;
        const from = document.getElementById('receivableFrom').value;
        const amount = document.getElementById('receivableAmount').value;
        const dueDate = document.getElementById('receivableDueDate').value;
        const description = document.getElementById('receivableDescription').value;
        
        // Create or update receivable
        const receivable = {
          id: id ? parseInt(id) : Date.now(), // Use existing ID or create new one
          from,
          amount: parseFloat(amount),
          dueDate: new Date(dueDate).toISOString(),
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('receivable', receivable);
        
        // Refresh receivables list
        loadReceivables();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('receivableModal');
      });
      
      // Setup payable form
      document.getElementById('payableForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('payableId').value;
        const to = document.getElementById('payableTo').value;
        const amount = document.getElementById('payableAmount').value;
        const dueDate = document.getElementById('payableDueDate').value;
        const description = document.getElementById('payableDescription').value;
        
        // Create or update payable
        const payable = {
          id: id ? parseInt(id) : Date.now(),
          to,
          amount: parseFloat(amount),
          dueDate: new Date(dueDate).toISOString(),
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('payable', payable);
        
        // Refresh payables list
        loadPayables();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('payableModal');
      });
      
      // Setup investment form
      document.getElementById('investmentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('investmentId').value;
        const name = document.getElementById('investmentName').value;
        const amount = document.getElementById('investmentAmount').value;
        const type = document.getElementById('investmentType').value;
        const description = document.getElementById('investmentDescription').value;
        
        // Create or update investment
        const investment = {
          id: id ? parseInt(id) : Date.now(),
          name,
          amount: parseFloat(amount),
          type,
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('investment', investment);
        
        // Refresh investments list
        loadInvestments();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('investmentModal');
      });
      
      // Setup budget form
      document.getElementById('budgetForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('budgetId').value;
        const name = document.getElementById('budgetName').value;
        const targetAmount = document.getElementById('budgetTargetAmount').value;
        const category = document.getElementById('budgetCategory').value;
        const deadline = document.getElementById('budgetDeadline').value;
        
        // Create or update budget
        const budget = {
          id: id ? parseInt(id) : Date.now(),
          name,
          targetAmount: parseFloat(targetAmount),
          category,
          deadline: new Date(deadline).toISOString()
        };
        
        // Save to localStorage
        saveToLocalStorage('budget', budget);
        
        // Refresh budgets list
        loadBudgets();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('budgetModal');
      });
      
      // Setup account form
      document.getElementById('accountForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('accountId').value;
        const name = document.getElementById('accountName').value;
        const accountNumber = document.getElementById('accountNumber').value;
        const balance = document.getElementById('accountBalance').value;
        
        // Create or update account
        const account = {
          id: id ? parseInt(id) : Date.now(),
          name,
          accountNumber,
          balance: parseFloat(balance)
        };
        
        // Save to localStorage
        saveToLocalStorage('account', account);
        
        // Refresh accounts list
        loadAccounts();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('accountModal');
      });
      
      // Setup chit form
      document.getElementById('chitForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('chitId').value;
        const name = document.getElementById('chitName').value;
        const amount = document.getElementById('chitAmount').value;
        const startMonth = document.getElementById('chitStartMonth').value;
        const startYear = document.getElementById('chitStartYear').value;
        const duration = document.getElementById('chitDuration').value;
        const description = document.getElementById('chitDescription').value;
        
        // Create start and maturity dates
        const startDate = new Date(parseInt(startYear), parseInt(startMonth), 1);
        const maturityDate = new Date(startDate);
        maturityDate.setMonth(maturityDate.getMonth() + parseInt(duration));
        
        // Create or update chit
        const chit = {
          id: id ? parseInt(id) : Date.now(),
          name,
          amount: parseFloat(amount),
          startDate: startDate.toISOString(),
          maturityDate: maturityDate.toISOString(),
          duration: parseInt(duration),
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('chit', chit);
        
        // Refresh chits list
        loadChits();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('chitModal');
      });
      
      // Setup money lent form
      document.getElementById('moneyLentForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('moneyLentId').value;
        const to = document.getElementById('moneyLentTo').value;
        const amount = document.getElementById('moneyLentAmount').value;
        const date = document.getElementById('moneyLentDate').value;
        const description = document.getElementById('moneyLentDescription').value;
        
        // Create or update money lent
        const moneyLent = {
          id: id ? parseInt(id) : Date.now(),
          to,
          amount: parseFloat(amount),
          date: new Date(date).toISOString(),
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('moneyLent', moneyLent);
        
        // Refresh money lent list
        loadMoneyLent();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('moneyLentModal');
      });
      
      // Setup past expense form
      document.getElementById('pastExpenseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('pastExpenseId').value;
        const name = document.getElementById('pastExpenseName').value;
        const amount = document.getElementById('pastExpenseAmount').value;
        const date = document.getElementById('pastExpenseDate').value;
        const category = document.getElementById('pastExpenseCategory').value;
        const description = document.getElementById('pastExpenseDescription').value;
        
        // Create or update past expense
        const pastExpense = {
          id: id ? parseInt(id) : Date.now(),
          name,
          amount: parseFloat(amount),
          date: new Date(date).toISOString(),
          category,
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('pastExpense', pastExpense);
        
        // Refresh past expenses list
        loadPastExpenses();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('pastExpenseModal');
      });
      
      // Setup upcoming expense form
      document.getElementById('upcomingExpenseForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        // Get form data
        const id = document.getElementById('upcomingExpenseId').value;
        const name = document.getElementById('upcomingExpenseName').value;
        const amount = document.getElementById('upcomingExpenseAmount').value;
        const date = document.getElementById('upcomingExpenseDate').value;
        const category = document.getElementById('upcomingExpenseCategory').value;
        const description = document.getElementById('upcomingExpenseDescription').value;
        
        // Create or update upcoming expense
        const upcomingExpense = {
          id: id ? parseInt(id) : Date.now(),
          name,
          amount: parseFloat(amount),
          date: new Date(date).toISOString(),
          category,
          description
        };
        
        // Save to localStorage
        saveToLocalStorage('upcomingExpense', upcomingExpense);
        
        // Refresh upcoming expenses list
        loadUpcomingExpenses();
        
        // Update dashboard
        updateFinancialSummary();
        
        // Close modal
        hideModal('upcomingExpenseModal');
      });
      
      // Initialize financial data
      initializeFinancialData();
    });
    
    // Check if offline
    function checkConnectivity() {
      if (navigator.onLine) {
        offlineBanner.classList.remove('visible');
      } else {
        offlineBanner.classList.add('visible');
      }
    }
    
    // Helper function to save entity to localStorage
    function saveToLocalStorage(type, item) {
      // Map of entity types to their storage keys
      const entityMap = {
        'receivable': STORAGE_KEYS.RECEIVABLES,
        'payable': STORAGE_KEYS.PAYABLES,
        'investment': STORAGE_KEYS.INVESTMENTS,
        'budget': STORAGE_KEYS.BUDGETS,
        'account': STORAGE_KEYS.ACCOUNTS,
        'chit': STORAGE_KEYS.CHITS,
        'moneyLent': STORAGE_KEYS.MONEY_LENT,
        'pastExpense': STORAGE_KEYS.PAST_EXPENSES,
        'upcomingExpense': STORAGE_KEYS.UPCOMING_EXPENSES
      };
      
      const storageKey = entityMap[type];
      if (!storageKey) return;
      
      try {
        // Get current items
        let items = JSON.parse(localStorage.getItem(storageKey) || '[]');
        
        // Check if item with the same ID already exists
        const existingIndex = items.findIndex(i => i.id == item.id);
        
        if (existingIndex >= 0) {
          // Update existing item
          items[existingIndex] = item;
        } else {
          // Add new item
          items.push(item);
        }
        
        // Save to localStorage
        localStorage.setItem(storageKey, JSON.stringify(items));
        
        // Update last sync time
        localStorage.setItem(STORAGE_KEYS.LAST_SYNC, new Date().toISOString());
      } catch (err) {
        console.error('Error saving to localStorage:', err);
        alert('Failed to save data. Please try again.');
      }
    }
    
    // Load all data from localStorage
    function loadAllData() {
      loadReceivables();
      loadPayables();
      loadInvestments();
      loadBudgets();
      loadAccounts();
      loadChits();
      loadMoneyLent();
      loadPastExpenses();
      loadUpcomingExpenses();
      updateFinancialSummary();
    }
    
    // Load receivables from localStorage
    function loadReceivables() {
      try {
        const receivables = JSON.parse(localStorage.getItem(STORAGE_KEYS.RECEIVABLES) || '[]');
        const tbody = document.querySelector('#receivablesTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (receivables.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No receivables yet. Click "+ Add Receivable" to create one.</td></tr>`;
          return;
        }
        
        // Sort by due date (ascending)
        receivables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
        
        // Add rows
        receivables.forEach((receivable) => {
          const dueDate = new Date(receivable.dueDate);
          const formattedDate = `${dueDate.toLocaleString('default', { month: 'short' })} ${dueDate.getDate()}`;
          
          const row = document.createElement('tr');
          row.id = `receivable-${receivable.id}`;
          row.innerHTML = `
            <td>${receivable.from}</td>
            <td>₹${receivable.amount.toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>
              <button onclick="editReceivable(${receivable.id})">Edit</button>
              <button onclick="deleteReceivable(${receivable.id})">Delete</button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error loading receivables:', err);
      }
    }
    
    // Load payables from localStorage
    function loadPayables() {
      try {
        const payables = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAYABLES) || '[]');
        const tbody = document.querySelector('#payablesTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (payables.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No payables yet. Click "+ Add Payable" to create one.</td></tr>`;
          return;
        }
        
        // Sort by due date (ascending)
        payables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
        
        // Add rows
        payables.forEach((payable) => {
          const dueDate = new Date(payable.dueDate);
          const formattedDate = `${dueDate.toLocaleString('default', { month: 'short' })} ${dueDate.getDate()}`;
          
          const row = document.createElement('tr');
          row.id = `payable-${payable.id}`;
          row.innerHTML = `
            <td>${payable.to}</td>
            <td>₹${payable.amount.toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>
              <button onclick="editPayable(${payable.id})">Edit</button>
              <button onclick="deletePayable(${payable.id})">Delete</button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error loading payables:', err);
      }
    }
    
    // Load investments from localStorage
    function loadInvestments() {
      try {
        const investments = JSON.parse(localStorage.getItem(STORAGE_KEYS.INVESTMENTS) || '[]');
        const tbody = document.querySelector('#investmentsTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (investments.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No investments yet. Click "+ Add Investment" to create one.</td></tr>`;
          return;
        }
        
        // Add rows
        investments.forEach((investment) => {
          const row = document.createElement('tr');
          row.id = `investment-${investment.id}`;
          row.innerHTML = `
            <td>${investment.name}</td>
            <td>${investment.type || 'General'}</td>
            <td>₹${investment.amount.toLocaleString()}</td>
            <td>
              <button onclick="editInvestment(${investment.id})">Edit</button>
              <button onclick="deleteInvestment(${investment.id})">Delete</button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error loading investments:', err);
      }
    }
    
    // Load budgets from localStorage
    function loadBudgets() {
      try {
        const budgets = JSON.parse(localStorage.getItem(STORAGE_KEYS.BUDGETS) || '[]');
        const tbody = document.querySelector('#budgetsTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (budgets.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No budgets yet. Click "+ Add Budget" to create one.</td></tr>`;
          return;
        }
        
        // Add rows
        budgets.forEach((budget) => {
          const deadline = new Date(budget.deadline);
          const formattedDate = `${deadline.toLocaleString('default', { month: 'short' })} ${deadline.getFullYear()}`;
          
          const row = document.createElement('tr');
          row.id = `budget-${budget.id}`;
          row.innerHTML = `
            <td>${budget.name}</td>
            <td>₹${budget.targetAmount.toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>
              <button onclick="editBudget(${budget.id})">Edit</button>
              <button onclick="deleteBudget(${budget.id})">Delete</button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error loading budgets:', err);
      }
    }
    
    // Load accounts from localStorage
    function loadAccounts() {
      try {
        const accounts = JSON.parse(localStorage.getItem(STORAGE_KEYS.ACCOUNTS) || '[]');
        const tbody = document.querySelector('#accountsTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (accounts.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="4" class="empty-state">No accounts yet. Click "+ Add Account" to create one.</td></tr>`;
          return;
        }
        
        // Add rows
        accounts.forEach((account) => {
          const row = document.createElement('tr');
          row.id = `account-${account.id}`;
          row.innerHTML = `
            <td>${account.name}</td>
            <td>${account.accountNumber}</td>
            <td>₹${account.balance.toLocaleString()}</td>
            <td>
              <button onclick="editAccount(${account.id})">Edit</button>
              <button onclick="deleteAccount(${account.id})">Delete</button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
      } catch (err) {
        console.error('Error loading accounts:', err);
      }
    }
    
    // Load chits from localStorage
    function loadChits() {
      try {
        const chits = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHITS) || '[]');
        const chitsList = document.getElementById('chitsList');
        const maturityList = document.querySelector('.maturity-list');
        
        if (!chitsList || !maturityList) return;
        
        // Clear existing items
        chitsList.innerHTML = '';
        maturityList.innerHTML = '';
        
        if (chits.length === 0) {
          // Show empty state
          chitsList.innerHTML = `<p class="empty-state">No chits yet. Click "+ Add Chit" to create one.</p>`;
          maturityList.innerHTML = `<p class="empty-state">No upcoming maturities.</p>`;
          return;
        }
        
        // Add chit items
        chits.forEach((chit) => {
          const startDate = new Date(chit.startDate);
          const maturityDate = new Date(chit.maturityDate);
          const formattedStartDate = startDate.toLocaleString('default', { month: 'short' }) + ' ' + startDate.getFullYear();
          
          // Calculate current value
          const currentValue = calculateChitValue(startDate, chit.amount, chit.duration);
          
          const chitItem = document.createElement('div');
          chitItem.className = 'list-item';
          chitItem.id = `chit-${chit.id}`;
          chitItem.innerHTML = `
            <div class="item-main">
              <div class="item-name">${chit.name}</div>
              <div class="item-details">₹${chit.amount.toLocaleString()} monthly • Started: ${formattedStartDate}</div>
            </div>
            <div class="item-amount">₹${currentValue.toLocaleString()}</div>
            <div class="item-actions">
              <button class="edit-button" onclick="editChit(${chit.id})">Edit</button>
              <button class="delete-button" onclick="deleteChit(${chit.id})">Delete</button>
            </div>
          `;
          
          chitsList.appendChild(chitItem);
          
          // Add to maturity timeline
          const monthsRemaining = getRemainingMonths(maturityDate);
          const progress = (chit.duration - monthsRemaining) / chit.duration * 100;
          const finalAmount = chit.amount * chit.duration;
          
          const maturityItem = document.createElement('div');
          maturityItem.className = 'maturity-item';
          maturityItem.innerHTML = `
            <div class="maturity-info">
              <span class="maturity-name">${chit.name}</span>
              <span class="maturity-date">${formatDateMMYYYY(maturityDate)}</span>
            </div>
            <div class="maturity-progress">
              <div class="progress-bar">
                <div class="progress-fill" style="width: ${progress}%"></div>
              </div>
              <div class="maturity-details">
                <span class="months-remaining">${monthsRemaining} months remaining</span>
                <span class="final-amount">Final: ₹${finalAmount.toLocaleString()}</span>
              </div>
            </div>
          `;
          
          maturityList.appendChild(maturityItem);
        });
      } catch (err) {
        console.error('Error loading chits:', err);
      }
    }
    
    // Load money lent from localStorage
    function loadMoneyLent() {
      try {
        const moneyLent = JSON.parse(localStorage.getItem(STORAGE_KEYS.MONEY_LENT) || '[]');
        const tbody = document.querySelector('#moneyLentTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (moneyLent.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No money lent yet. Click "+ Add Money Lent" to create one.</td></tr>`;
          return;
        }
        
        // Sort by date (descending)
        moneyLent.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Calculate total
        let total = 0;
        
        // Add rows
        moneyLent.forEach((item) => {
          const lentDate = new Date(item.date);
          const formattedDate = `${lentDate.toLocaleString('default', { month: 'short' })} ${lentDate.getDate()}, ${lentDate.getFullYear()}`;
          
          // Add to total
          total += parseFloat(item.amount);
          
          const row = document.createElement('tr');
          row.id = `moneyLent-${item.id}`;
          row.innerHTML = `
            <td>${item.to}</td>
            <td>₹${parseFloat(item.amount).toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>${item.description || '-'}</td>
            <td>
              <button class="icon-button edit-button" onclick="editMoneyLent(${item.id})" aria-label="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="icon-button delete-button" onclick="deleteMoneyLent(${item.id})" aria-label="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
        
        // Add total row
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
          <td><strong>Total</strong></td>
          <td><strong>₹${total.toLocaleString()}</strong></td>
          <td colspan="3"></td>
        `;
        tbody.appendChild(totalRow);
        
      } catch (err) {
        console.error('Error loading money lent:', err);
      }
    }
    
    // Load past expenses from localStorage
    function loadPastExpenses() {
      try {
        const pastExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAST_EXPENSES) || '[]');
        const tbody = document.querySelector('#pastExpensesTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (pastExpenses.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No past expenses yet. Click "+ Add Past Expense" to create one.</td></tr>`;
          return;
        }
        
        // Sort by date (descending - most recent first)
        pastExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Calculate total
        let total = 0;
        
        // Add rows
        pastExpenses.forEach((expense) => {
          const expenseDate = new Date(expense.date);
          const formattedDate = `${expenseDate.toLocaleString('default', { month: 'short' })} ${expenseDate.getDate()}, ${expenseDate.getFullYear()}`;
          
          // Add to total
          total += parseFloat(expense.amount);
          
          const row = document.createElement('tr');
          row.id = `pastExpense-${expense.id}`;
          row.innerHTML = `
            <td>${expense.name}</td>
            <td>₹${parseFloat(expense.amount).toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>${expense.category || '-'}</td>
            <td>
              <button class="icon-button edit-button" onclick="editPastExpense(${expense.id})" aria-label="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="icon-button delete-button" onclick="deletePastExpense(${expense.id})" aria-label="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
        
        // Add total row
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
          <td><strong>Total</strong></td>
          <td><strong>₹${total.toLocaleString()}</strong></td>
          <td colspan="3"></td>
        `;
        tbody.appendChild(totalRow);
        
      } catch (err) {
        console.error('Error loading past expenses:', err);
      }
    }
    
    // Load upcoming expenses from localStorage
    function loadUpcomingExpenses() {
      try {
        const upcomingExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.UPCOMING_EXPENSES) || '[]');
        const tbody = document.querySelector('#upcomingExpensesTable tbody');
        
        if (!tbody) return;
        
        // Clear existing rows
        tbody.innerHTML = '';
        
        if (upcomingExpenses.length === 0) {
          // Show empty state
          tbody.innerHTML = `<tr><td colspan="5" class="empty-state">No upcoming expenses yet. Click "+ Add Upcoming Expense" to create one.</td></tr>`;
          return;
        }
        
        // Sort by date (ascending - soonest first)
        upcomingExpenses.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // Calculate total
        let total = 0;
        
        // Add rows
        upcomingExpenses.forEach((expense) => {
          const expenseDate = new Date(expense.date);
          const formattedDate = `${expenseDate.toLocaleString('default', { month: 'short' })} ${expenseDate.getDate()}, ${expenseDate.getFullYear()}`;
          
          // Add to total
          total += parseFloat(expense.amount);
          
          const row = document.createElement('tr');
          row.id = `upcomingExpense-${expense.id}`;
          row.innerHTML = `
            <td>${expense.name}</td>
            <td>₹${parseFloat(expense.amount).toLocaleString()}</td>
            <td>${formattedDate}</td>
            <td>${expense.category || '-'}</td>
            <td>
              <button class="icon-button edit-button" onclick="editUpcomingExpense(${expense.id})" aria-label="Edit">
                <i class="fas fa-edit"></i>
              </button>
              <button class="icon-button delete-button" onclick="deleteUpcomingExpense(${expense.id})" aria-label="Delete">
                <i class="fas fa-trash"></i>
              </button>
            </td>
          `;
          
          tbody.appendChild(row);
        });
        
        // Add total row
        const totalRow = document.createElement('tr');
        totalRow.className = 'total-row';
        totalRow.innerHTML = `
          <td><strong>Total</strong></td>
          <td><strong>₹${total.toLocaleString()}</strong></td>
          <td colspan="3"></td>
        `;
        tbody.appendChild(totalRow);
        
      } catch (err) {
        console.error('Error loading upcoming expenses:', err);
      }
    }
    
    // Initialize financial data
    function initializeFinancialData() {
      // Only use data from localStorage - no dummy data
      
      // Load the stored data for each entity type
      loadAllData();
      
      // Also create appropriate page-switching events
      addPageSwitchListeners();
      
      // Update financial summary based on localStorage data
      updateFinancialSummary();
    }
    
    // Add listeners for page switching to ensure data is always refreshed
    function addPageSwitchListeners() {
      // When dashboard tab is clicked, refresh all summary data
      document.querySelector('.tab[onclick*="switchPage(\'dashboardPage\')"]').addEventListener('click', function() {
        // Need a slight delay to ensure the page is actually showing
        setTimeout(() => {
          updateFinancialSummary();
        }, 100);
      });
      
      // For the money tab, ensure the appropriate subpage is loaded with fresh data
      document.querySelector('.tab[onclick*="switchPage(\'moneyPage\')"]').addEventListener('click', function() {
        // Need a slight delay to ensure the page is actually showing
        setTimeout(() => {
          loadReceivables(); // Default subpage for money tab
        }, 100);
      });
      
      // For the investments tab
      document.querySelector('.tab[onclick*="switchPage(\'investmentsPage\')"]').addEventListener('click', function() {
        // Need a slight delay to ensure the page is actually showing
        setTimeout(() => {
          loadInvestments();
        }, 100);
      });
      
      // For the planning tab
      document.querySelector('.tab[onclick*="switchPage(\'planningPage\')"]').addEventListener('click', function() {
        // Need a slight delay to ensure the page is actually showing
        setTimeout(() => {
          loadBudgets(); // Default subpage for planning tab
        }, 100);
      });
    }
    
    // Switch between pages
    function switchPage(pageId) {
      // Hide all pages
      pages.forEach(page => {
        page.classList.remove('active');
      });
      
      // Handle grouped pages
      if (pageId === 'moneyPage') {
        // Show Receivables by default when Money tab is clicked
        document.getElementById('receivablesPage').classList.add('active');
        
        // Also load Money submenu (we'll create this later)
        loadSubMenu('money');
      } else if (pageId === 'planningPage') {
        // Show Budgets by default when Planning tab is clicked
        document.getElementById('budgetsPage').classList.add('active');
        
        // Also load Planning submenu
        loadSubMenu('planning');
      } else {
        // Show the exact page for non-grouped tabs
        document.getElementById(pageId).classList.add('active');
        
        // Clear any submenu
        clearSubMenu();
      }
      
      // Update tabs
      tabs.forEach(tab => {
        tab.classList.remove('active');
      });
      
      // Find the tab that points to this page
      const activeTab = Array.from(tabs).find(tab => {
        return tab.getAttribute('onclick').includes(pageId);
      });
      
      if (activeTab) {
        activeTab.classList.add('active');
      }
    }
    
    // Handle submenu for grouped pages
    function loadSubMenu(group) {
      // Clear any existing submenu
      clearSubMenu();
      
      // Create submenu container if it doesn't exist
      let submenu = document.getElementById('submenu');
      if (!submenu) {
        submenu = document.createElement('div');
        submenu.id = 'submenu';
        submenu.className = 'submenu';
        
        // Add to DOM
        const mainContent = document.querySelector('.app-container');
        mainContent.insertBefore(submenu, mainContent.firstChild);
      }
      
      // Add appropriate submenu options based on group
      if (group === 'money') {
        submenu.innerHTML = `
          <a href="#" class="submenu-item active" onclick="switchSubPage('receivablesPage')">Receivables</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('payablesPage')">Payables</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('accountsPage')">Accounts</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('moneyLentPage')">Money Lent</a>
        `;
      } else if (group === 'planning') {
        submenu.innerHTML = `
          <a href="#" class="submenu-item active" onclick="switchSubPage('budgetsPage')">Budgets</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('chitsPage')">Chits</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('pastExpensesPage')">Past Expenses</a>
          <a href="#" class="submenu-item" onclick="switchSubPage('upcomingExpensesPage')">Upcoming Expenses</a>
        `;
      }
      
      // Add styles for submenu
      const style = document.createElement('style');
      style.id = 'submenu-style';
      style.textContent = `
        .submenu {
          display: flex;
          overflow-x: auto;
          background: white;
          margin-bottom: 12px;
          border-radius: 8px;
          box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
          white-space: nowrap;
        }
        .submenu-item {
          padding: 12px 16px;
          color: #333;
          text-decoration: none;
          position: relative;
        }
        .submenu-item.active {
          color: #6d28d9;
          font-weight: bold;
        }
        .submenu-item.active:after {
          content: '';
          position: absolute;
          bottom: 0;
          left: 16px;
          right: 16px;
          height: 3px;
          background: #6d28d9;
          border-radius: 3px 3px 0 0;
        }
      `;
      
      // Add style to head if it doesn't exist
      if (!document.getElementById('submenu-style')) {
        document.head.appendChild(style);
      }
    }
    
    function clearSubMenu() {
      const submenu = document.getElementById('submenu');
      if (submenu) {
        submenu.remove();
      }
    }
    
    function switchSubPage(pageId) {
      // Hide all pages
      pages.forEach(page => {
        page.classList.remove('active');
      });
      
      // Show the selected subpage
      document.getElementById(pageId).classList.add('active');
      
      // Update submenu items
      const submenuItems = document.querySelectorAll('.submenu-item');
      submenuItems.forEach(item => {
        item.classList.remove('active');
      });
      
      // Find and activate the clicked submenu item
      const activeSubmenuItem = Array.from(submenuItems).find(item => {
        return item.getAttribute('onclick').includes(pageId);
      });
      
      if (activeSubmenuItem) {
        activeSubmenuItem.classList.add('active');
      }
      
      // Refresh the data based on which subpage is shown
      if (pageId === 'receivablesPage') {
        loadReceivables();
      } else if (pageId === 'payablesPage') {
        loadPayables();
      } else if (pageId === 'accountsPage') {
        loadAccounts();
      } else if (pageId === 'budgetsPage') {
        loadBudgets();
      } else if (pageId === 'chitsPage') {
        loadChits();
      } else if (pageId === 'moneyLentPage') {
        loadMoneyLent();
      } else if (pageId === 'pastExpensesPage') {
        loadPastExpenses();
      } else if (pageId === 'upcomingExpensesPage') {
        loadUpcomingExpenses();
      }
    }
    
    // Show modal
    function showModal(modalId, skipReset = false) {
      document.getElementById(modalId).classList.add('active');
      
      // Only reset the form if skipReset is false (for new items)
      if (!skipReset) {
        if (modalId === 'receivableModal') {
          document.getElementById('receivableModalTitle').textContent = 'Add Receivable';
          document.getElementById('receivableForm').reset();
          document.getElementById('receivableId').value = '';
          
          // Set today's date by default
          const today = new Date();
          const formattedDate = today.toISOString().split('T')[0];
          document.getElementById('receivableDueDate').value = formattedDate;
        } 
        else if (modalId === 'payableModal') {
          document.getElementById('payableModalTitle').textContent = 'Add Payable';
          document.getElementById('payableForm').reset();
          document.getElementById('payableId').value = '';
          
          // Set today's date by default
          const today = new Date();
          const formattedDate = today.toISOString().split('T')[0];
          document.getElementById('payableDueDate').value = formattedDate;
        }
        else if (modalId === 'investmentModal') {
          document.getElementById('investmentModalTitle').textContent = 'Add Investment';
          document.getElementById('investmentForm').reset();
          document.getElementById('investmentId').value = '';
        }
        else if (modalId === 'budgetModal') {
          document.getElementById('budgetModalTitle').textContent = 'Add Budget';
          document.getElementById('budgetForm').reset();
          document.getElementById('budgetId').value = '';
          
          // Set a default deadline date (1 year from now)
          const oneYearFromNow = new Date();
          oneYearFromNow.setFullYear(oneYearFromNow.getFullYear() + 1);
          const formattedDate = oneYearFromNow.toISOString().split('T')[0];
          document.getElementById('budgetDeadline').value = formattedDate;
        }
        else if (modalId === 'accountModal') {
          document.getElementById('accountModalTitle').textContent = 'Add Bank Account';
          document.getElementById('accountForm').reset();
          document.getElementById('accountId').value = '';
        }
        else if (modalId === 'chitModal') {
          document.getElementById('chitModalTitle').textContent = 'Add Chit';
          document.getElementById('chitForm').reset();
          document.getElementById('chitId').value = '';
          
          // Set default values for new chit
          const today = new Date();
          document.getElementById('chitStartMonth').value = today.getMonth().toString();
          document.getElementById('chitStartYear').value = today.getFullYear().toString();
          document.getElementById('chitDuration').value = '24'; // 2 years default
        }
        else if (modalId === 'moneyLentModal') {
          document.getElementById('moneyLentModalTitle').textContent = 'Add Money Lent';
          document.getElementById('moneyLentForm').reset();
          document.getElementById('moneyLentId').value = '';
          
          // Set today's date by default
          const today = new Date();
          const formattedDate = today.toISOString().split('T')[0];
          document.getElementById('moneyLentDate').value = formattedDate;
        }
        else if (modalId === 'pastExpenseModal') {
          document.getElementById('pastExpenseModalTitle').textContent = 'Add Past Expense';
          document.getElementById('pastExpenseForm').reset();
          document.getElementById('pastExpenseId').value = '';
          
          // Set today's date by default
          const today = new Date();
          const formattedDate = today.toISOString().split('T')[0];
          document.getElementById('pastExpenseDate').value = formattedDate;
        }
        else if (modalId === 'upcomingExpenseModal') {
          document.getElementById('upcomingExpenseModalTitle').textContent = 'Add Upcoming Expense';
          document.getElementById('upcomingExpenseForm').reset();
          document.getElementById('upcomingExpenseId').value = '';
          
          // Set a default date 30 days from now by default
          const futureDate = new Date();
          futureDate.setDate(futureDate.getDate() + 30);
          const formattedDate = futureDate.toISOString().split('T')[0];
          document.getElementById('upcomingExpenseDate').value = formattedDate;
        }
      }
    }
    
    // Hide modal
    function hideModal(modalId) {
      document.getElementById(modalId).classList.remove('active');
    }
    
    // Form actions to load data from localStorage for editing
    function editReceivable(id) {
      try {
        // Get all receivables
        const receivables = JSON.parse(localStorage.getItem(STORAGE_KEYS.RECEIVABLES) || '[]');
        
        // Find the specified receivable
        const receivable = receivables.find(r => r.id == id);
        if (!receivable) {
          alert('Could not find the receivable to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('receivableModalTitle').textContent = 'Edit Receivable';
        
        // Populate form fields
        document.getElementById('receivableId').value = receivable.id;
        document.getElementById('receivableFrom').value = receivable.from;
        document.getElementById('receivableAmount').value = receivable.amount;
        
        // Format date for input field (YYYY-MM-DD)
        const dueDate = new Date(receivable.dueDate);
        const formattedDate = dueDate.toISOString().split('T')[0];
        document.getElementById('receivableDueDate').value = formattedDate;
        
        document.getElementById('receivableDescription').value = receivable.description || '';
        
        // Show modal with skipReset=true to prevent form reset
        showModal('receivableModal', true);
      } catch (err) {
        console.error('Error editing receivable:', err);
        alert('An error occurred while trying to edit the receivable.');
      }
    }
    
    function editPayable(id) {
      try {
        // Get all payables
        const payables = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAYABLES) || '[]');
        
        // Find the specified payable
        const payable = payables.find(p => p.id == id);
        if (!payable) {
          alert('Could not find the payable to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('payableModalTitle').textContent = 'Edit Payable';
        
        // Populate form fields
        document.getElementById('payableId').value = payable.id;
        document.getElementById('payableTo').value = payable.to;
        document.getElementById('payableAmount').value = payable.amount;
        
        // Format date for input field (YYYY-MM-DD)
        const dueDate = new Date(payable.dueDate);
        const formattedDate = dueDate.toISOString().split('T')[0];
        document.getElementById('payableDueDate').value = formattedDate;
        
        document.getElementById('payableDescription').value = payable.description || '';
        
        // Show modal with skipReset=true to prevent form reset
        showModal('payableModal', true);
      } catch (err) {
        console.error('Error editing payable:', err);
        alert('An error occurred while trying to edit the payable.');
      }
    }
    
    function editInvestment(id) {
      try {
        // Get all investments
        const investments = JSON.parse(localStorage.getItem(STORAGE_KEYS.INVESTMENTS) || '[]');
        
        // Find the specified investment
        const investment = investments.find(i => i.id == id);
        if (!investment) {
          alert('Could not find the investment to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('investmentModalTitle').textContent = 'Edit Investment';
        
        // Populate form fields
        document.getElementById('investmentId').value = investment.id;
        document.getElementById('investmentName').value = investment.name;
        document.getElementById('investmentAmount').value = investment.amount;
        document.getElementById('investmentType').value = investment.type || '';
        document.getElementById('investmentDescription').value = investment.description || '';
        
        // Show modal with skipReset=true to prevent form reset
        showModal('investmentModal', true);
      } catch (err) {
        console.error('Error editing investment:', err);
        alert('An error occurred while trying to edit the investment.');
      }
    }
    
    function editBudget(id) {
      try {
        // Get all budgets
        const budgets = JSON.parse(localStorage.getItem(STORAGE_KEYS.BUDGETS) || '[]');
        
        // Find the specified budget
        const budget = budgets.find(b => b.id == id);
        if (!budget) {
          alert('Could not find the budget to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('budgetModalTitle').textContent = 'Edit Budget';
        
        // Populate form fields
        document.getElementById('budgetId').value = budget.id;
        document.getElementById('budgetName').value = budget.name;
        document.getElementById('budgetTargetAmount').value = budget.targetAmount;
        document.getElementById('budgetCategory').value = budget.category || '';
        
        // Format date for input field (YYYY-MM-DD)
        const deadline = new Date(budget.deadline);
        const formattedDate = deadline.toISOString().split('T')[0];
        document.getElementById('budgetDeadline').value = formattedDate;
        
        // Show modal with skipReset=true to prevent form reset
        showModal('budgetModal', true);
      } catch (err) {
        console.error('Error editing budget:', err);
        alert('An error occurred while trying to edit the budget.');
      }
    }
    
    function editAccount(id) {
      try {
        // Get all accounts
        const accounts = JSON.parse(localStorage.getItem(STORAGE_KEYS.ACCOUNTS) || '[]');
        
        // Find the specified account
        const account = accounts.find(a => a.id == id);
        if (!account) {
          alert('Could not find the account to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('accountModalTitle').textContent = 'Edit Account';
        
        // Populate form fields
        document.getElementById('accountId').value = account.id;
        document.getElementById('accountName').value = account.name;
        document.getElementById('accountNumber').value = account.accountNumber;
        document.getElementById('accountBalance').value = account.balance;
        
        // Show modal with skipReset=true to prevent form reset
        showModal('accountModal', true);
      } catch (err) {
        console.error('Error editing account:', err);
        alert('An error occurred while trying to edit the account.');
      }
    }
    
    function editChit(id) {
      try {
        // Get all chits
        const chits = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHITS) || '[]');
        
        // Find the specified chit
        const chit = chits.find(c => c.id == id);
        if (!chit) {
          alert('Could not find the chit to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('chitModalTitle').textContent = 'Edit Chit';
        
        // Populate form fields
        document.getElementById('chitId').value = chit.id;
        document.getElementById('chitName').value = chit.name;
        document.getElementById('chitAmount').value = chit.amount;
        
        // Get start date values
        const startDate = new Date(chit.startDate);
        document.getElementById('chitStartMonth').value = startDate.getMonth().toString();
        document.getElementById('chitStartYear').value = startDate.getFullYear().toString();
        
        document.getElementById('chitDuration').value = chit.duration;
        document.getElementById('chitDescription').value = chit.description || '';
        
        // Show modal with skipReset=true to prevent form reset
        showModal('chitModal', true);
      } catch (err) {
        console.error('Error editing chit:', err);
        alert('An error occurred while trying to edit the chit.');
      }
    }
    
    function editMoneyLent(id) {
      try {
        // Get all money lent records
        const moneyLent = JSON.parse(localStorage.getItem(STORAGE_KEYS.MONEY_LENT) || '[]');
        
        // Find the specified record
        const record = moneyLent.find(m => m.id == id);
        if (!record) {
          alert('Could not find the money lent record to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('moneyLentModalTitle').textContent = 'Edit Money Lent';
        
        // Populate form fields
        document.getElementById('moneyLentId').value = record.id;
        document.getElementById('moneyLentTo').value = record.to;
        document.getElementById('moneyLentAmount').value = record.amount;
        document.getElementById('moneyLentDescription').value = record.description || '';
        
        // Format date for input field (YYYY-MM-DD)
        const date = new Date(record.date);
        const formattedDate = date.toISOString().split('T')[0];
        document.getElementById('moneyLentDate').value = formattedDate;
        
        // Show modal with skipReset=true to prevent form reset
        showModal('moneyLentModal', true);
      } catch (err) {
        console.error('Error editing money lent record:', err);
        alert('An error occurred while trying to edit the money lent record.');
      }
    }
    
    function editPastExpense(id) {
      try {
        // Get all past expenses
        const pastExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAST_EXPENSES) || '[]');
        
        // Find the specific expense
        const expense = pastExpenses.find(e => e.id == id);
        if (!expense) {
          alert('Could not find the past expense to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('pastExpenseModalTitle').textContent = 'Edit Past Expense';
        
        // Populate form fields
        document.getElementById('pastExpenseId').value = expense.id;
        document.getElementById('pastExpenseName').value = expense.name;
        document.getElementById('pastExpenseAmount').value = expense.amount;
        document.getElementById('pastExpenseCategory').value = expense.category || '';
        document.getElementById('pastExpenseDescription').value = expense.description || '';
        
        // Format date for input field (YYYY-MM-DD)
        const date = new Date(expense.date);
        const formattedDate = date.toISOString().split('T')[0];
        document.getElementById('pastExpenseDate').value = formattedDate;
        
        // Show modal with skipReset=true to prevent form reset
        showModal('pastExpenseModal', true);
      } catch (err) {
        console.error('Error editing past expense:', err);
        alert('An error occurred while trying to edit the past expense.');
      }
    }
    
    function editUpcomingExpense(id) {
      try {
        // Get all upcoming expenses
        const upcomingExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.UPCOMING_EXPENSES) || '[]');
        
        // Find the specific expense
        const expense = upcomingExpenses.find(e => e.id == id);
        if (!expense) {
          alert('Could not find the upcoming expense to edit.');
          return;
        }
        
        // Set modal title
        document.getElementById('upcomingExpenseModalTitle').textContent = 'Edit Upcoming Expense';
        
        // Populate form fields
        document.getElementById('upcomingExpenseId').value = expense.id;
        document.getElementById('upcomingExpenseName').value = expense.name;
        document.getElementById('upcomingExpenseAmount').value = expense.amount;
        document.getElementById('upcomingExpenseCategory').value = expense.category || '';
        document.getElementById('upcomingExpenseDescription').value = expense.description || '';
        
        // Format date for input field (YYYY-MM-DD)
        const date = new Date(expense.date);
        const formattedDate = date.toISOString().split('T')[0];
        document.getElementById('upcomingExpenseDate').value = formattedDate;
        
        // Show modal with skipReset=true to prevent form reset
        showModal('upcomingExpenseModal', true);
      } catch (err) {
        console.error('Error editing upcoming expense:', err);
        alert('An error occurred while trying to edit the upcoming expense.');
      }
    }
    
    // Generic delete function for all entity types
    function deleteItem(type, id) {
      // Map of entity types to their storage keys, friendly names and loaders
      const entityMap = {
        'receivable': { 
          key: STORAGE_KEYS.RECEIVABLES, 
          name: 'Receivable', 
          loader: loadReceivables 
        },
        'payable': { 
          key: STORAGE_KEYS.PAYABLES, 
          name: 'Payable', 
          loader: loadPayables 
        },
        'investment': { 
          key: STORAGE_KEYS.INVESTMENTS, 
          name: 'Investment', 
          loader: loadInvestments 
        },
        'budget': { 
          key: STORAGE_KEYS.BUDGETS, 
          name: 'Budget', 
          loader: loadBudgets
        },
        'account': { 
          key: STORAGE_KEYS.ACCOUNTS, 
          name: 'Account', 
          loader: loadAccounts 
        },
        'chit': { 
          key: STORAGE_KEYS.CHITS, 
          name: 'Chit', 
          loader: loadChits 
        },
        'moneyLent': { 
          key: STORAGE_KEYS.MONEY_LENT, 
          name: 'Money Lent', 
          loader: loadMoneyLent 
        },
        'pastExpense': {
          key: STORAGE_KEYS.PAST_EXPENSES,
          name: 'Past Expense',
          loader: loadPastExpenses
        },
        'upcomingExpense': {
          key: STORAGE_KEYS.UPCOMING_EXPENSES,
          name: 'Upcoming Expense',
          loader: loadUpcomingExpenses
        }
      };
      
      const entity = entityMap[type];
      if (!entity) return;
      
      if (confirm(`Are you sure you want to delete this ${entity.name.toLowerCase()}?`)) {
        try {
          // Get current items from localStorage
          let items = JSON.parse(localStorage.getItem(entity.key) || '[]');
          
          // Filter out the item to delete
          items = items.filter(item => item.id != id);
          
          // Save back to localStorage
          localStorage.setItem(entity.key, JSON.stringify(items));
          
          // Reload the appropriate list using the loader function
          if (entity.loader && typeof entity.loader === 'function') {
            entity.loader();
          }
          
          // Update financial totals on dashboard
          updateFinancialSummary();
          
          // Show success message
          alert(`${entity.name} deleted successfully!`);
        } catch (err) {
          console.error('Error deleting item:', err);
          alert(`Error deleting ${entity.name.toLowerCase()}. Please try again.`);
        }
      }
    }
    
    // Helper functions for specific entity types (for backwards compatibility)
    function deleteReceivable(id) {
      deleteItem('receivable', id);
    }
    
    function deletePayable(id) {
      deleteItem('payable', id);
    }
    
    function deleteInvestment(id) {
      deleteItem('investment', id);
    }
    
    function deleteBudget(id) {
      deleteItem('budget', id);
    }
    
    function deleteAccount(id) {
      deleteItem('account', id);
    }
    
    function deleteChit(id) {
      deleteItem('chit', id);
    }
    
    function deleteMoneyLent(id) {
      deleteItem('moneyLent', id);
    }
    
    function deletePastExpense(id) {
      deleteItem('pastExpense', id);
    }
    
    function deleteUpcomingExpense(id) {
      deleteItem('upcomingExpense', id);
    }
    
    // Update financial summary on dashboard
    function updateFinancialSummary() {
      try {
        // Calculate totals from localStorage
        const receivables = JSON.parse(localStorage.getItem(STORAGE_KEYS.RECEIVABLES) || '[]');
        const payables = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAYABLES) || '[]');
        const investments = JSON.parse(localStorage.getItem(STORAGE_KEYS.INVESTMENTS) || '[]');
        const accounts = JSON.parse(localStorage.getItem(STORAGE_KEYS.ACCOUNTS) || '[]');
        const chits = JSON.parse(localStorage.getItem(STORAGE_KEYS.CHITS) || '[]');
        const moneyLent = JSON.parse(localStorage.getItem(STORAGE_KEYS.MONEY_LENT) || '[]');
        
        // Calculate totals
        const totalReceivables = receivables.reduce((sum, r) => sum + Number(r.amount), 0);
        const totalMoneyLent = moneyLent.reduce((sum, m) => sum + Number(m.amount), 0);
        const totalPayables = payables.reduce((sum, p) => sum + Number(p.amount), 0);
        const totalInvestments = investments.reduce((sum, i) => sum + Number(i.amount), 0);
        const totalBankBalance = accounts.reduce((sum, a) => sum + Number(a.balance), 0);
        
        // Calculate total chit value
        let totalChits = 0;
        chits.forEach(chit => {
          const startDate = new Date(chit.startDate);
          totalChits += calculateChitValue(startDate, Number(chit.amount), Number(chit.duration));
        });
        
        // Calculate net worth
        const netWorth = totalBankBalance + totalReceivables + totalMoneyLent + totalInvestments + totalChits - totalPayables;
        
        // Update UI
        document.getElementById('totalReceivables').textContent = '₹' + totalReceivables.toLocaleString();
        document.getElementById('totalMoneyLent').textContent = '₹' + totalMoneyLent.toLocaleString();
        document.getElementById('totalPayables').textContent = '₹' + totalPayables.toLocaleString();
        document.getElementById('totalInvestments').textContent = '₹' + totalInvestments.toLocaleString();
        document.getElementById('totalChits').textContent = '₹' + totalChits.toLocaleString();
        document.getElementById('totalBankBalance').textContent = '₹' + totalBankBalance.toLocaleString();
        document.getElementById('netWorth').textContent = '₹' + netWorth.toLocaleString();
        
        // Update dashboard tables
        updateDashboardReceivables(receivables);
        updateDashboardMoneyLent(moneyLent);
        updateDashboardPayables(payables);
      } catch (err) {
        console.error('Error updating financial summary:', err);
      }
    }
    
    // Update dashboard receivables table
    function updateDashboardReceivables(receivables) {
      const table = document.getElementById('dashboardReceivablesTable').getElementsByTagName('tbody')[0];
      table.innerHTML = '';
      
      // Sort by due date (ascending)
      receivables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
      
      // Take only the first 3 items for dashboard
      const topReceivables = receivables.slice(0, 3);
      
      if (topReceivables.length === 0) {
        const row = table.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 3;
        cell.textContent = 'No receivables found';
        cell.style.textAlign = 'center';
        cell.style.padding = '10px';
        return;
      }
      
      topReceivables.forEach(receivable => {
        const row = table.insertRow();
        
        const fromCell = row.insertCell(0);
        fromCell.textContent = receivable.from;
        
        const amountCell = row.insertCell(1);
        amountCell.textContent = '₹' + Number(receivable.amount).toLocaleString();
        
        const dateCell = row.insertCell(2);
        const dueDate = new Date(receivable.dueDate);
        dateCell.textContent = formatDateMMDD(dueDate);
      });
    }
    
    // Update dashboard payables table
    function updateDashboardPayables(payables) {
      const table = document.getElementById('dashboardPayablesTable').getElementsByTagName('tbody')[0];
      table.innerHTML = '';
      
      // Sort by due date (ascending)
      payables.sort((a, b) => new Date(a.dueDate) - new Date(b.dueDate));
      
      // Take only the first 3 items for dashboard
      const topPayables = payables.slice(0, 3);
      
      if (topPayables.length === 0) {
        const row = table.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 3;
        cell.textContent = 'No payables found';
        cell.style.textAlign = 'center';
        cell.style.padding = '10px';
        return;
      }
      
      topPayables.forEach(payable => {
        const row = table.insertRow();
        
        const toCell = row.insertCell(0);
        toCell.textContent = payable.to;
        
        const amountCell = row.insertCell(1);
        amountCell.textContent = '₹' + Number(payable.amount).toLocaleString();
        
        const dateCell = row.insertCell(2);
        const dueDate = new Date(payable.dueDate);
        dateCell.textContent = formatDateMMDD(dueDate);
      });
    }
    
    // Update dashboard money lent table
    function updateDashboardMoneyLent(moneyLent) {
      const table = document.getElementById('dashboardMoneyLentTable').getElementsByTagName('tbody')[0];
      table.innerHTML = '';
      
      // Sort by date (descending - most recent first)
      moneyLent.sort((a, b) => new Date(b.date) - new Date(a.date));
      
      // Take only the first 3 items for dashboard
      const topMoneyLent = moneyLent.slice(0, 3);
      
      if (topMoneyLent.length === 0) {
        const row = table.insertRow();
        const cell = row.insertCell(0);
        cell.colSpan = 3;
        cell.textContent = 'No money lent found';
        cell.style.textAlign = 'center';
        cell.style.padding = '10px';
        return;
      }
      
      topMoneyLent.forEach(item => {
        const row = table.insertRow();
        
        const toCell = row.insertCell(0);
        toCell.textContent = item.to;
        
        const amountCell = row.insertCell(1);
        amountCell.textContent = '₹' + Number(item.amount).toLocaleString();
        
        const dateCell = row.insertCell(2);
        const lentDate = new Date(item.date);
        dateCell.textContent = formatDateMMDD(lentDate);
      });
    }
    
    // Helper function to format date as MMM DD
    function formatDateMMDD(date) {
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return `${months[date.getMonth()]} ${date.getDate()}`;
    }
    
    // Calculate current chit value based on start date and monthly amount
    function calculateChitValue(startDate, monthlyAmount, duration) {
      // Get current date and ensure we're working with Date objects
      const today = new Date();
      startDate = new Date(startDate);
      
      // Set both dates to the 1st of their respective months for accurate month counting
      const startDateFirstOfMonth = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
      const todayFirstOfMonth = new Date(today.getFullYear(), today.getMonth(), 1);
      
      // Calculate months elapsed since start (1st of each month) 
      const monthsElapsed = (todayFirstOfMonth.getFullYear() - startDateFirstOfMonth.getFullYear()) * 12 + 
                          (todayFirstOfMonth.getMonth() - startDateFirstOfMonth.getMonth());
      
      // If started in the future, value is 0
      if (monthsElapsed < 0) return 0;
      
      // +1 to include the current month if we're past the 1st of the month
      const effectiveMonths = monthsElapsed + 1;
      
      // Calculate based on months elapsed up to duration
      const contributingMonths = Math.min(effectiveMonths, duration);
      return contributingMonths * monthlyAmount;
    }
    
    // Get the remaining months until maturity
    function getRemainingMonths(maturityDate) {
      const today = new Date();
      maturityDate = new Date(maturityDate);
      
      return (maturityDate.getFullYear() - today.getFullYear()) * 12 + 
           (maturityDate.getMonth() - today.getMonth());
    }
    
    // Load past expenses from localStorage
    function loadPastExpenses() {
      try {
        const pastExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.PAST_EXPENSES) || '[]');
        const pastExpensesList = document.getElementById('pastExpensesList');
        const totalRow = document.getElementById('pastExpensesTotalRow');
        
        if (!pastExpensesList || !totalRow) return;
        
        // Clear existing items
        pastExpensesList.innerHTML = '';
        
        if (pastExpenses.length === 0) {
          // Show empty state
          pastExpensesList.innerHTML = `<p class="empty-state">No past expenses yet. Click "+ Add Expense" to create one.</p>`;
          totalRow.innerHTML = `
            <span class="total-label">Total</span>
            <span class="total-amount">₹0</span>
          `;
          return;
        }
        
        // Sort by date (descending)
        pastExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));
        
        // Calculate total
        let total = 0;
        
        // Add items
        pastExpenses.forEach((expense) => {
          const expenseDate = new Date(expense.date);
          const formattedDate = `${expenseDate.toLocaleString('default', { month: 'short' })} ${expenseDate.getFullYear()}`;
          
          // Add to total
          total += parseFloat(expense.amount);
          
          const item = document.createElement('div');
          item.className = 'list-item';
          item.id = `pastExpense-${expense.id}`;
          item.innerHTML = `
            <div class="item-main">
              <div class="item-name">${expense.name}</div>
              <div class="item-details">${formattedDate} • ${expense.category || 'General'}</div>
            </div>
            <div class="item-amount">₹${parseFloat(expense.amount).toLocaleString()}</div>
            <div class="item-actions">
              <button class="action-button edit-button" onclick="editPastExpense(${expense.id})"><i class="fa fa-edit"></i></button>
              <button class="action-button delete-button" onclick="deleteItem('pastExpense', ${expense.id})"><i class="fa fa-trash"></i></button>
            </div>
          `;
          
          pastExpensesList.appendChild(item);
        });
        
        // Update total row
        totalRow.innerHTML = `
          <span class="total-label">Total</span>
          <span class="total-amount">₹${total.toLocaleString()}</span>
        `;
      } catch (err) {
        console.error('Error loading past expenses:', err);
      }
    }
    
    // Load upcoming expenses from localStorage
    function loadUpcomingExpenses() {
      try {
        const upcomingExpenses = JSON.parse(localStorage.getItem(STORAGE_KEYS.UPCOMING_EXPENSES) || '[]');
        const upcomingExpensesList = document.getElementById('upcomingExpensesList');
        const totalRow = document.getElementById('upcomingExpensesTotalRow');
        
        if (!upcomingExpensesList || !totalRow) return;
        
        // Clear existing items
        upcomingExpensesList.innerHTML = '';
        
        if (upcomingExpenses.length === 0) {
          // Show empty state
          upcomingExpensesList.innerHTML = `<p class="empty-state">No upcoming expenses yet. Click "+ Add Expense" to create one.</p>`;
          totalRow.innerHTML = `
            <span class="total-label">Total</span>
            <span class="total-amount">₹0</span>
          `;
          return;
        }
        
        // Sort by date (ascending)
        upcomingExpenses.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        // Calculate total
        let total = 0;
        
        // Add items
        upcomingExpenses.forEach((expense) => {
          const expenseDate = new Date(expense.date);
          const formattedDate = `${expenseDate.toLocaleString('default', { month: 'short' })} ${expenseDate.getFullYear()}`;
          
          // Add to total
          total += parseFloat(expense.amount);
          
          const item = document.createElement('div');
          item.className = 'list-item';
          item.id = `upcomingExpense-${expense.id}`;
          item.innerHTML = `
            <div class="item-main">
              <div class="item-name">${expense.name}</div>
              <div class="item-details">${formattedDate} • ${expense.category || 'General'}</div>
            </div>
            <div class="item-amount">₹${parseFloat(expense.amount).toLocaleString()}</div>
            <div class="item-actions">
              <button class="action-button edit-button" onclick="editUpcomingExpense(${expense.id})"><i class="fa fa-edit"></i></button>
              <button class="action-button delete-button" onclick="deleteItem('upcomingExpense', ${expense.id})"><i class="fa fa-trash"></i></button>
            </div>
          `;
          
          upcomingExpensesList.appendChild(item);
        });
        
        // Update total row
        totalRow.innerHTML = `
          <span class="total-label">Total</span>
          <span class="total-amount">₹${total.toLocaleString()}</span>
        `;
      } catch (err) {
        console.error('Error loading upcoming expenses:', err);
      }
    }
    
    // Format date for display (MMM YYYY format)
    function formatDateMMYYYY(date) {
      const d = new Date(date);
      const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
      return `${months[d.getMonth()]} ${d.getFullYear()}`;
    }
  </script>
</body>
</html>